import { Comment, Element, ProcessingInstruction, Text } from 'domhandler';
import htmlToDOM from 'html-dom-parser';

import attributesToProps from './lib/attributes-to-props.js';
import domToReact from './lib/dom-to-react.js';

var domParserOptions = { lowerCaseAttributeNames: false };

/**
 * Converts HTML string to React elements.
 *
 * @param {string} html - HTML string.
 * @param {object} [options] - Parser options.
 * @param {object} [options.htmlparser2] - htmlparser2 options.
 * @param {object} [options.library] - Library for React, Preact, etc.
 * @param {Function} [options.replace] - Replace method.
 * @returns {JSX.Element|JSX.Element[]|string} - React element(s), empty array, or string.
 */
function HTMLReactParser(html, options) {
  if (typeof html !== 'string') {
    throw new TypeError('First argument must be a string');
  }
  if (html === '') {
    return [];
  }
  options = options || {};
  return domToReact(
    htmlToDOM(html, options.htmlparser2 || domParserOptions),
    options
  );
}

HTMLReactParser.domToReact = domToReact;
HTMLReactParser.htmlToDOM = htmlToDOM;
HTMLReactParser.attributesToProps = attributesToProps;

// domhandler
HTMLReactParser.Comment = Comment;
HTMLReactParser.Element = Element;
HTMLReactParser.ProcessingInstruction = ProcessingInstruction;
HTMLReactParser.Text = Text;
HTMLReactParser.default = HTMLReactParser;

export default HTMLReactParser;
